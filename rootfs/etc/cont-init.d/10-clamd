#!/usr/bin/with-contenv bash

### Setup Persistent Storage
if [ ! -d /data ]; then
  mkdir -p /data
fi

chown -R clamav:clamav /data

### Setup Logs
mkdir -p /var/log/clamav
chown -R clamav:clamav /var/log/clamav

### Check for Definitions
if [ ! -f /data/main.cvd  ]; then
  echo '** [clamav] No Definitions Found, Downloading..'
  freshclam --user=clamav --verbose --show-progress --log=/var/log/clamav/freshclam.log
fi

mkdir -p /tmp/state
touch /tmp/state/10-clamd-init
